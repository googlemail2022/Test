<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My+ ‚Äî –ø—Ä–æ—Ç–æ—Ç–∏–ø</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900">

  <!-- –ù–∞–≤–±–∞—Ä -->
  <header class="bg-white shadow-md p-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold text-red-500">My+</h1>
    <nav class="flex space-x-6">
      <a href="#" class="hover:text-red-500" data-nav>–õ–µ–Ω—Ç–∞</a>
      <a href="#" class="hover:text-red-500" data-nav>–ö—Ä—É–∂–∫–∏</a>
      <a href="#" class="hover:text-red-500" data-nav>–°–æ–æ–±—â–µ—Å—Ç–≤–∞</a>
      <a href="#" class="hover:text-red-500" data-nav>–ü–æ–¥–±–æ—Ä–∫–∏</a>
      <a href="#" class="hover:text-red-500" data-nav>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
    </nav>
    <button id="loginBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg">–í–æ–π—Ç–∏</button>
  </header>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <main class="container mx-auto mt-6 grid grid-cols-1 md:grid-cols-3 gap-6">

    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–ø—Ä–æ—Ñ–∏–ª—å / –º–µ–Ω—é) -->
    <aside class="bg-white p-4 rounded-lg shadow-md">
      <h2 class="font-bold mb-2">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-12 h-12 bg-gray-300 rounded-full"></div>
        <div>
          <p id="username" class="font-semibold">–ì–æ—Å—Ç—å</p>
          <p id="useremail" class="text-sm text-gray-500">–ù–µ –≤–æ—à–ª–∏</p>
        </div>
      </div>
      <ul class="space-y-2">
        <li><a href="#" class="text-blue-500">–ú–æ–∏ –ø–æ—Å—Ç—ã</a></li>
        <li><a href="#" class="text-blue-500">–ö—Ä—É–∂–∫–∏</a></li>
        <li><a href="#" class="text-blue-500">–°–æ–æ–±—â–µ—Å—Ç–≤–∞</a></li>
        <li><a href="#" class="text-blue-500">–ü–æ–¥–±–æ—Ä–∫–∏</a></li>
      </ul>
    </aside>

    <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–ª–µ–Ω—Ç–∞) -->
    <section class="md:col-span-2">
      <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ -->
      <div class="bg-white p-4 rounded-lg shadow-md mb-6">
        <textarea id="postInput" class="w-full p-2 border rounded-md" rows="3" placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?"></textarea>
        <div class="flex justify-between items-center mt-2">
          <small id="charCount" class="text-sm text-gray-500">0 / 1000</small>
          <button id="postBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        </div>
      </div>

      <!-- –õ–µ–Ω—Ç–∞ -->
      <div id="feed"></div>
    </section>
  </main>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –ª–æ–≥–∏–Ω–∞ -->
  <div id="loginModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-80">
      <h2 class="text-xl font-bold mb-4">–í—Ö–æ–¥</h2>
      <input id="loginName" type="text" placeholder="–ò–º—è" class="w-full mb-2 p-2 border rounded-md">
      <input id="loginEmail" type="email" placeholder="Email" class="w-full mb-4 p-2 border rounded-md">
      <div class="flex justify-end space-x-2">
        <button id="closeLogin" class="px-3 py-2 bg-gray-300 rounded-lg">–û—Ç–º–µ–Ω–∞</button>
        <button id="submitLogin" class="px-3 py-2 bg-red-500 text-white rounded-lg">–í–æ–π—Ç–∏</button>
      </div>
    </div>
  </div>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (toast) -->
  <div id="toast" class="fixed bottom-6 right-6 hidden bg-gray-800 text-white px-4 py-2 rounded-md shadow-md"></div>

  <script>
    /********** –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è localStorage **********/
    function savePosts(posts) {
      localStorage.setItem('posts', JSON.stringify(posts));
    }
    function loadPosts() {
      try {
        return JSON.parse(localStorage.getItem('posts') || '[]');
      } catch (e) {
        return [];
      }
    }
    function saveUser(user) {
      if (user) localStorage.setItem('user', JSON.stringify(user));
      else localStorage.removeItem('user');
    }
    function loadUser() {
      try {
        return JSON.parse(localStorage.getItem('user') || 'null');
      } catch (e) {
        return null;
      }
    }

    /********** –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (–ø—Ä–æ—Å—Ç–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç XSS) **********/
    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    /********** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ UI **********/
    const feed = document.getElementById('feed');
    const postBtn = document.getElementById('postBtn');
    const postInput = document.getElementById('postInput');
    const charCount = document.getElementById('charCount');
    const loginBtn = document.getElementById('loginBtn');
    const loginModal = document.getElementById('loginModal');
    const closeLogin = document.getElementById('closeLogin');
    const submitLogin = document.getElementById('submitLogin');
    const usernameEl = document.getElementById('username');
    const useremailEl = document.getElementById('useremail');
    const toast = document.getElementById('toast');

    /********** –°–æ—Å—Ç–æ—è–Ω–∏–µ **********/
    let posts = loadPosts(); // newest first (index 0 ‚Äî —Å–∞–º—ã–π –Ω–æ–≤—ã–π)
    let user = loadUser();

    /********** Render –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç DOM —ç–ª–µ–º–µ–Ω—Ç) **********/
    function createPostElement(post) {
      const wrapper = document.createElement('div');
      wrapper.className = 'bg-white p-4 rounded-lg shadow-md mb-4 post';
      wrapper.dataset.id = post.id;

      wrapper.innerHTML = `
        <div class="flex items-center space-x-3 mb-2">
          <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center text-sm text-gray-700">${escapeHtml(post.author[0] || 'G')}</div>
          <div>
            <p class="font-semibold">${escapeHtml(post.author)}</p>
            <p class="text-sm text-gray-500">${escapeHtml(post.time)}</p>
          </div>
        </div>
        <p class="mb-3 post-text">${escapeHtml(post.text)}</p>
        <div class="flex space-x-4 text-gray-500">
          <button data-action="like" class="hover:text-red-500">üëç –ù—Ä–∞–≤–∏—Ç—Å—è (<span class="like-count">${post.likes}</span>)</button>
          <button data-action="comment" class="hover:text-red-500">üí¨ –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å (<span class="comment-count">${post.comments}</span>)</button>
          <button data-action="share" class="hover:text-red-500">‚Üó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è (<span class="share-count">${post.shares}</span>)</button>
        </div>
      `;
      return wrapper;
    }

    /********** Render –ª–µ–Ω—Ç—ã **********/
    function renderFeed() {
      feed.innerHTML = '';
      if (posts.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'bg-white p-6 rounded-lg shadow-md text-gray-600';
        empty.textContent = '–õ–µ–Ω—Ç–∞ –ø—É—Å—Ç–∞ ‚Äî –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç!';
        feed.appendChild(empty);
        return;
      }
      posts.forEach(post => {
        feed.appendChild(createPostElement(post));
      });
    }

    /********** –î–µ–π—Å—Ç–≤–∏—è –ø–æ –∫–ª–∏–∫—É (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ) **********/
    feed.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-action]');
      if (!btn) return;
      const action = btn.dataset.action;
      const postEl = btn.closest('.post');
      if (!postEl) return;
      const id = postEl.dataset.id;
      const idx = posts.findIndex(p => p.id === id);
      if (idx === -1) return;

      if (action === 'like') {
        posts[idx].likes++;
        savePosts(posts);
        // –û–±–Ω–æ–≤–∏–º —Ç–æ–ª—å–∫–æ —Å—á—ë—Ç—á–∏–∫ –≤ DOM, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å –≤—Å—é –ª–µ–Ω—Ç—É
        const span = postEl.querySelector('.like-count');
        if (span) span.textContent = posts[idx].likes;
      } else if (action === 'comment') {
        const text = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è). –¢–µ–∫—Å—Ç –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—ë—Ç—Å—è –≤ —ç—Ç–æ–º –ø—Ä–æ—Ç–æ—Ç–∏–ø–µ:');
        if (text !== null && text.trim() !== '') {
          posts[idx].comments++;
          savePosts(posts);
          const span = postEl.querySelector('.comment-count');
          if (span) span.textContent = posts[idx].comments;
          showToast('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω (–≤ –¥–µ–º–æ–ø–∞–º—è—Ç–∏)');
        }
      } else if (action === 'share') {
        posts[idx].shares++;
        savePosts(posts);
        const span = postEl.querySelector('.share-count');
        if (span) span.textContent = posts[idx].shares;
        showToast('–ü–æ—Å—Ç "–ø–æ–¥–µ–ª–∏–ª—Å—è" (–¥–µ–º–æ)');
      }
    });

    /********** –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞ **********/
    postBtn.addEventListener('click', () => {
      const text = postInput.value.trim();
      if (!text) {
        showToast('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞.');
        return;
      }
      const author = user ? user.name : '–ì–æ—Å—Ç—å';
      const newPost = {
        id: String(Date.now()) + '-' + Math.random().toString(36).slice(2,7),
        author,
        text,
        time: new Date().toLocaleString(),
        likes: 0,
        comments: 0,
        shares: 0
      };
      // newest first
      posts.unshift(newPost);
      savePosts(posts);
      // –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ DOM –±–µ–∑ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏
      feed.insertBefore(createPostElement(newPost), feed.firstChild);
      postInput.value = '';
      updateCharCount();
      showToast('–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω');
    });

    /********** –õ–æ–≥–∏–Ω/–ª–æ–≥–∞—É—Ç **********/
    function updateUserUI() {
      if (user) {
        usernameEl.textContent = user.name;
        useremailEl.textContent = user.email;
        loginBtn.textContent = '–í—ã–π—Ç–∏';
      } else {
        usernameEl.textContent = '–ì–æ—Å—Ç—å';
        useremailEl.textContent = '–ù–µ –≤–æ—à–ª–∏';
        loginBtn.textContent = '–í–æ–π—Ç–∏';
      }
    }

    loginBtn.addEventListener('click', () => {
      if (user) {
        // –ª–æ–≥–∞—É—Ç
        if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
          user = null;
          saveUser(null);
          updateUserUI();
        }
      } else {
        loginModal.classList.remove('hidden');
      }
    });

    closeLogin.addEventListener('click', () => {
      loginModal.classList.add('hidden');
    });

    submitLogin.addEventListener('click', () => {
      const name = document.getElementById('loginName').value.trim();
      const email = document.getElementById('loginEmail').value.trim();
      if (!name || !email) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ email');
        return;
      }
      user = { name, email };
      saveUser(user);
      updateUserUI();
      loginModal.classList.add('hidden');
      showToast('–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ ' + name);
    });

    /********** Char counter **********/
    function updateCharCount() {
      const len = postInput.value.length;
      charCount.textContent = `${len} / 1000`;
    }
    postInput.addEventListener('input', updateCharCount);

    /********** Toast **********/
    let toastTimer = null;
    function showToast(text) {
      toast.textContent = text;
      toast.classList.remove('hidden');
      if (toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.add('hidden'), 2500);
    }

    /********** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã **********/
    (function init() {
      updateCharCount();
      updateUserUI();
      renderFeed();

      // –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏: –µ—Å–ª–∏ –ª–µ–Ω—Ç–∞ –ø—É—Å—Ç–∞—è ‚Äî –¥–æ–±–∞–≤–∏–º –ø—Ä–∏–º–µ—Ä–Ω—ã–π –ø–æ—Å—Ç (–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ)
      if (posts.length === 0) {
        const demoPost = {
          id: 'demo-1',
          author: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
          text: '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Å—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ª–∞–π–∫–∞—Ç—å, –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–≤–æ–∏ –ø–æ—Å—Ç—ã ‚Äî –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage.',
          time: new Date().toLocaleString(),
          likes: 0,
          comments: 0,
          shares: 0
        };
        posts.unshift(demoPost);
        savePosts(posts);
        renderFeed();
      }
    })();
  </script>
</body>
</html>